services:
  broker1883:
    image: eclipse-mosquitto
    ports:
      - "1883:1883"
    volumes:
      - ./broker:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - broker-passwd

  broker2883:
    image: eclipse-mosquitto
    ports:
      - "2883:1883"
    volumes:
      - ./broker:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - broker-passwd

  broker3883:
    image: eclipse-mosquitto
    ports:
      - "3883:1883"
    volumes:
      - ./broker:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - broker-passwd

  bridge1884:
    image: eclipse-mosquitto
    ports:
      - "1884:1883"
    volumes:
      - ./bridge:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - bridge-passwd
    depends_on:
      broker1883:
        condition: service_started
        restart: true

  bridge2884:
    image: eclipse-mosquitto
    ports:
      - "2884:1883"
    volumes:
      - ./bridge:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - bridge-passwd
    depends_on:
      broker2883:
        condition: service_started
        restart: true

  bridge3884:
    image: eclipse-mosquitto
    ports:
      - "3884:1883"
    volumes:
      - ./bridge:/mosquitto/config
    restart: unless-stopped
    user: 1000:1000
    secrets:
      - bridge-passwd
    depends_on:
      broker3883:
        condition: service_started
        restart: true

secrets:
  broker-passwd:
    file: broker/broker-passwd
  bridge-passwd:
    file: bridge/bridge-passwd

#bridge
#connection dyson-fan
#address 10.0.0.248:1883
#remote_clientid paho33135379815290
#remote_username VS9-EU-KFA2511A
#remote_password *****
#bridge_protocol_version mqttv311
#try_private false
#notifications false
#cleansession true
#topic # both 0


#services:
#  mqtt-bridge:
#    image: eclipse-mosquitto
#    ports:
#      - "1883:1884"
#    networks:
#      - front-tier
#      - back-tier
#    configs:
#      - httpd-config
#    secrets:
#      - server-certificate
#
#  backend:
#    image: example/database
#    volumes:
#      - db-data:/etc/data
#    networks:
#      - back-tier
#
#volumes:
#  db-data:
#    driver: flocker
#    driver_opts:
#      size: "10GiB"
#
#configs:
#  httpd-config:
#    external: true
#
#secrets:
#  server-certificate:
#    external: true
#
#networks:
#  # The presence of these objects is sufficient to define them
#  front-tier: {}
#  back-tier: {}
